{% extends "main.html" %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% block content %}
    <div>
        <div class="d-flex">

        </div>
        <div class="d-flex row">
            <div class="col-md">
            <h4>Údaje o klientovi</h4>
                <form action="" method="POST">
                {% csrf_token %}
                    <a class="btn btn-warning" href="{% url "clients" %}">Zpět bez uložení</a>
                    {% if client.id %}
                    <a class="btn btn-secondary" href="{% url "manage-attachments" client.id %}">Spravovat přílohy</a>
                    {% endif %}
                    <input class="btn btn-success" type="submit" value="Uložit">
                    <p>{{ form.consumer|as_crispy_field }}</p>
                    <div class="row">
                      <div class="col-6">
                        {{ form.name|as_crispy_field }}
                      </div>
                      <div class="col-6">
                        {{ form.email|as_crispy_field }}
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        {{ form.id_number|as_crispy_field }}
                      </div>
                      <div class="col-6">
                        {{ form.phone_number|as_crispy_field }}
                      </div>
                    </div>
                    {{ form.address|as_crispy_field }}
                    {{ form.note|as_crispy_field }}

                    <input class="btn btn-success" type="submit" value="Uložit">
                    </form>
            </div>
        <div class="col-md">
        {% if client %}
            <h4>Nahrané přílohy ke klientovi {{ client.name }}</h4>
                <table class="table table-striped">
                <thead>
                    <th scope="col">Název souboru</th>
                    <th scope="col">Název přílohy</th>
                    <th scope="col">Součást nabídky</th>
                    <th scope="col">Součást smlouvy</th>
                </thead>
                <tbody>
                    {% for attachment in client.attachments.all %}
                        <tr>
                            <td>{{ attachment.file }}</td>
                            <td>{{ attachment.name }}</td>
                            <td>{{ attachment.add_to_proposal }}</td>
                            <td>{{ attachment.add_to_contract }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
                </table>
        <br>
            {% endif %}
        {% if client.proposals.all %}
            <h4>Nabídky</h4>
            <table class="table table-striped">
                <thead>
                    <th scope="col">Číslo nabídky</th>
                    <th scope="col">Vytvořena dne</th>
                    <th scope="col">Podkladová nabídka</th>
                    <th scope="col">Odeslána klientovi</th>
                </thead>
                <tbody>
                    {% for proposal in client.proposals.all %}
                        <tr>
                            <td><a href="{% url "edit-proposal" proposal.id %}">{{ proposal.proposal_number }}</a></td>
                            <td>{{ proposal.created_at }}</td>
                            <td>{{ proposal.uploaded.last }}</td>
                            <td>{{ proposal.signed_at }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
                </table>
            {% if client.contracts.all %}
                <br>
                <h4>Smlouvy</h4>
                <table class="table table-striped">
                <thead>
                    <th scope="col">Číslo smlouvy</th>
                    <th scope="col">Vytvořena dne</th>
                    <th scope="col">Vychází z nabídky</th>
                    <th scope="col">Podepsaná klientem</th>
                </thead>
                <tbody>
                    {% for contract in client.contracts.all %}
                        <tr>
                            <td><a href="{% url "edit-contract" contract.id %}">{{ contract.proposal_number }}</a></td>
                            <td>{{ contract.created_at }}</td>
                            <td>{{ contract.proposal.last }}</td>
                            <td>{{ contract.signed_at }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
                </table>
            {% else %}
                <h4>Klient {{ client.name }} nemá vytvořenou smlouvu.</h4>
            {% endif %}

        {% elif client %}
            <h4>Klient {{ client.name }} nemá vytvořenou nabídku.</h4>
            <a class="btn btn-success" href="{% url "create-proposal" client.id %}">Vytvořit nabídku</a>
        {% endif %}
        </div>
        </div>
    </div>




{% endblock %}
